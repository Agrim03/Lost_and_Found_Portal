<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <title>Delhi Metro Lost and Found_Login</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <!-- Fonts -->
  <link href="https://fonts.googleapis.com/css2?family=Lato&display=swap" rel="stylesheet">
  <link href="https://fonts.googleapis.com/css?family=League+Spartan" rel="stylesheet">

  <!-- Font Awesome -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">

  <!-- Custom Styles -->
  <link rel="stylesheet" href="style.css" />
</head>

<body>

  <!-- ======= HEADER ======= -->
  <header>
    <div class="navbar">
      <div class="navbar-left">
        <p>Follow us on : </p>
        <ul class="navbar-left-list1">
          <li><a href="#"><img src="images/fb_icon.png" alt="FB" height="20"></a></li>
          <li><a href="#"><img src="images/instagram_icon.png" alt="Insta" height="20"></a></li>
          <li><a href="#"><img src="images/x_icon.png" alt="X" height="20"></a></li>
          <li><a href="#"><img src="images/playstore_icon.png" alt="Play" height="20"></a></li>
        </ul>
      </div>
    </div>

    <!-- ======= MAIN HEADER ======= -->
    <div class="header-main">
      <div class="header-left">
        <img src="images/dmrc_logo.png" alt="DMRC Logo" />
      </div>

      <div class="header-right">
        <div class="helpline">
          <img src="images/helpline.svg" alt="Helpline" height="15">
          Helpline <br>
          <span style="color: green; font-weight: bold;">155370</span>
        </div>

        <div class="search-bar">
          <input type="text" placeholder="Search...">
          <i class="fa-solid fa-magnifying-glass"></i>
        </div>

        <nav class="secondary-navbar">
          <ul>
            <li><a href="dashboard.html">Home</a></li>
            <li><a href="#footer">Contact</a></li>
            <li><a href="profile.html">Profile</a></li>
          </ul>
        </nav>
      </div>
    </div>
  </header>

  <main>
    <main class="container">
    <div class="left-column">
      <div class="main-title-left">
        <p style="font-family: 'League Spartan', sans-serif; color: #b51d1d;">User <br>Profile</p>
      </div>
      <aside class="sidebar">
        <h2>Actions</h2>
        <ul class="sidebar-links">
          <li><span><i class="fa-solid fa-star"></i></span><a href="lost.html"> Report Lost Item</a></li>
          <li><span><i class="fa-solid fa-star"></i></span><a href="found.html"> Report Found Item</a></li>
          <li><span><i class="fa-solid fa-star"></i></span><a href="view.html">View Reports/ Search Item</a></li>
        </ul>
      </aside>
    </div>
      <div class="user-details">
       <form id="profileForm">
         <label>Name</label>
         <input type="text" name="name" placeholder="Text" readonly />

        <label>Contact No.</label>
        <input type="tel" name="phone" placeholder="Phone number" />

        <label>Address</label>
        <input type="text" name="address" placeholder="Address" />

        <label>Email</label>
        <input type="email" name="email" placeholder="Email" readonly />

       <button type="submit">Save</button>
      </form>

      </div>
    </div>
  </main>
   <footer>
    <div class="footer-content">
      <p>Â© 2025 Delhi Metro Rail Corporation Ltd. All rights reserved.</p>
    </div>
  </footer>

  <script>
  window.onload = async function () {
    try {
      const res = await fetch("/api/user");
      if (!res.ok) throw new Error("Not logged in");

      const user = await res.json();
      const form = document.getElementById("profileForm");

      form.name.value = user.name || "";
      form.email.value = user.email || "";
      form.phone.value = user.phone || "";
      form.address.value = user.address || "";
    } catch (err) {
      alert("Please log in to view your profile.");
      window.location.href = "/login.html";
    }
  };

  document.getElementById("profileForm").addEventListener("submit", async function (e) {
    e.preventDefault();
    const formData = {
      phone: this.phone.value,
      address: this.address.value,
    };

    try {
      const res = await fetch("/api/user/update", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify(formData),
      });

      if (res.ok) {
        alert("Profile updated successfully!");
      } else {
        alert("Failed to update profile.");
      }
    } catch (err) {
      console.error(err);
      alert("An error occurred.");
    }
  });
</script>


</body>
</html>
